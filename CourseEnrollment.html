<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>课程管理 / Course Management</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 5px; margin-top: 3px; }
    button { margin-top: 10px; padding: 8px 12px; margin-right: 5px; }
    hr { margin: 25px 0; }
    #classContainer { margin-top: 15px; }
    table { width: 100%; border-collapse: collapse; }
    td { vertical-align: top; border: 1px solid #ddd; padding: 5px; width: 14%; }
  </style>
</head>
<body>
  <h2>课程管理 / Course Management</h2>

  <!-- ========== 课程录入表单 ========== -->
  <h3>课程录入 / Add New Class</h3>
  <label>Class Name<input type="text" id="className"></label>
  <label>Short Description<input type="text" id="shortDescription"></label>
  <label>Date From<input type="date" id="dateFrom"></label>
  <label>Date To<input type="date" id="dateTo"></label>
  <label>Time From<input type="time" id="timeFrom"></label>
  <label>Time To<input type="time" id="timeTo"></label>
  <label>Day of Week
    <select id="dayOfWeek">
      <option>Monday</option><option>Tuesday</option><option>Wednesday</option>
      <option>Thursday</option><option>Friday</option><option>Saturday</option><option>Sunday</option>
    </select>
  </label>
  <label>Teacher Name<input type="text" id="teacherName"></label>
  <label>Teacher Contact Number<input type="text" id="teacherContactNumber"></label>
  <label>Teacher Email<input type="email" id="teachersEmail"></label>
  <label>Age From<input type="number" id="ageFrom"></label>
  <label>Age To<input type="number" id="ageTo"></label>
  <label>Maximum Position<input type="number" id="maximumPosition"></label>
  <button id="submitBtn" onclick="submitClass()">提交课程 / Submit</button>

  <hr>

  <!-- ========== 课程查询区 ========== -->
  <h3>课程查询 / Course Lookup</h3>
  <button onclick="renderMode=1; renderClasses()">常规模式</button>
  <button onclick="renderMode=2; renderClasses()">按星期分组</button>
  <div id="classContainer">加载中...</div>

  <script src="config.js"></script>
  <script>
    let renderMode = 1;
    let allClasses = [];

    // === 提交课程 ===
    async function submitClass() {
      const btn = document.getElementById("submitBtn");
      btn.disabled = true;
      btn.textContent = "提交中... / Submitting...";

      try {
        const data = {
          className: document.getElementById("className").value,
          shortDescription: document.getElementById("shortDescription").value,
          dateFrom: document.getElementById("dateFrom").value,
          dateTo: document.getElementById("dateTo").value,
          timeFrom: document.getElementById("timeFrom").value,
          timeTo: document.getElementById("timeTo").value,
          dayOfWeek: document.getElementById("dayOfWeek").value,
          teacherName: document.getElementById("teacherName").value,
          teacherContactNumber: document.getElementById("teacherContactNumber").value,
          teachersEmail: document.getElementById("teachersEmail").value,
          ageFrom: document.getElementById("ageFrom").value,
          ageTo: document.getElementById("ageTo").value,
          maximumPosition: document.getElementById("maximumPosition").value
        };

        const res = await fetch(`${API_URL}?action=addClass`, {
          method: "POST",
          headers: { "Content-Type": "text/plain" }, // 兼容 Apps Script
          body: JSON.stringify(data)
        });

        const json = await res.json();
        if (json.ok) {
          alert("✅ 课程已录入成功！");
          await loadClasses(); // 刷新课程列表
        } else {
          alert("❌ 录入失败: " + json.error);
        }
      } catch (err) {
        alert("提交出错: " + err.message);
      } finally {
        btn.disabled = false;
        btn.textContent = "提交课程 / Submit";
      }
    }

    // === 加载课程 ===
    async function loadClasses() {
      try {
        const res = await fetch(`${API_URL}?action=getClasses`);
        const json = await res.json();
        if (json.ok) {
          allClasses = json.classes;
          renderClasses();
        } else {
          document.getElementById("classContainer").textContent = "加载失败";
        }
      } catch (err) {
        document.getElementById("classContainer").textContent = "加载出错: " + err.message;
      }
    }

    // === 渲染课程 ===
    function renderClasses() {
      const container = document.getElementById("classContainer");
      container.innerHTML = "";

      if (renderMode === 1) {
        // 常规模式
        let rowDiv = document.createElement("div");
        allClasses.forEach((cls, idx) => {
          const btn = document.createElement("button");
          btn.textContent = cls.ClassName;
          btn.onclick = () => showClassDetail(cls);
          rowDiv.appendChild(btn);

          if ((idx + 1) % 5 === 0) {
            container.appendChild(rowDiv);
            rowDiv = document.createElement("div");
          }
        });
        if (rowDiv.children.length > 0) container.appendChild(rowDiv);

      } else if (renderMode === 2) {
        // 按星期分组
        const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
        const table = document.createElement("table");
        const tr = document.createElement("tr");

        days.forEach(day => {
          const td = document.createElement("td");
          const dayClasses = allClasses.filter(c => c.DayOfWeek === day);

          dayClasses.forEach(cls => {
            const btn = document.createElement("button");
            btn.textContent = cls.ClassName;
            btn.onclick = () => showClassDetail(cls);
            td.appendChild(btn);
            td.appendChild(document.createElement("br"));
          });

          tr.appendChild(td);
        });

        table.appendChild(tr);
        container.appendChild(table);
      }
    }

    // === 显示课程详情 ===
    function showClassDetail(cls) {
      alert(`
课程 / Class Name: ${cls.ClassName}
简介 / Short Description: ${cls.ShortDescription || ""}
老师 / Teacher Name: ${cls.TeacherName}
联系方式 / Teacher Contact Number: ${cls.TeacherContactNumber}, ${cls.TeachersEmail}
上课时间 / Class Date/Time: ${cls.DayOfWeek} ${cls.TimeFrom} - ${cls.TimeTo}
起止日期 / Date From ~ Date To: ${cls.DateFrom} 至 ${cls.DateTo}
人数上限 / Maximum Position: ${cls.MaximumPosition}
年龄 / Age Range: ${cls.AgeFrom}-${cls.AgeTo}
      `);
    }

    window.onload = loadClasses;
  </script>
</body>
</html>
