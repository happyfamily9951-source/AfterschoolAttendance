<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Attendance UI Test (Accent Bar - Optimized)</title>
<style>
  body {
    font-family: "Inter", system-ui, sans-serif;
    background: #f8fafc;
    margin: 0;
    padding: 0;
    color: #333;
  }

  .container {
    max-width: 960px;
    margin: 0 auto;
    padding: 16px;
  }

  .class-info {
    text-align: center;
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 18px;
  }

  .stats {
    text-align: center;
    margin-bottom: 16px;
    font-size: 16px; /* 与学生名同级 */
    font-weight: 500;
  }

  /* ===== 按钮区域 ===== */
  .btn-group {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 24px;
  }

  .attendance-btn {
    flex: 1;
    padding: 12px 0;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 16px; /* 与学生姓名、统计一致 */
    color: white;
    transition: transform 0.1s ease;
  }

  .attendance-btn.present { background: #28a745; }
  .attendance-btn.absent { background: #dc3545; }
  .attendance-btn.leave { background: #ffc107; color: #333; }
  .attendance-btn.active { transform: scale(1.05); }

  /* ===== 学生卡区域 ===== */
  .student-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
  }

  .student-card {
    position: relative;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    text-align: center;
    cursor: pointer;
    overflow: hidden;
    transition: all 0.25s ease;
    border: 1px solid #e5e7eb;
    min-height: 130px; /* 高度统一 */
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .status-bar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 10px; /* 调整为一半高度 */
    border-top-left-radius: 14px;
    border-top-right-radius: 14px;
  }

  /* 三种状态颜色 */
  .student-card.present .status-bar { background: #28a745; }
  .student-card.absent  .status-bar { background: #dc3545; }
  .student-card.leave   .status-bar { background: #ffc107; }

  .student-name {
    font-weight: 600;
    font-size: 16px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    margin-top: 20px;
    color: #111827;
  }

  .student-note {
    font-size: 13px;
    color: #6b7280;
    min-height: 18px; /* 预留空间保证高度一致 */
  }

  .student-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  /* 手机端布局：1 行 3 个卡片 */
  @media (max-width: 600px) {
    .student-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>
</head>
<body>
<div class="container">
  <div class="class-info" id="classTitle">2025Q3-SatFun (Sat)</div>
  <div class="stats" id="statsBar">Total: 0 | 🟢 P: 0 | 🔴 A: 0 | 🟡 L: 0</div>

  <div class="btn-group">
    <button class="attendance-btn present active" id="presentBtn">Present</button>
    <button class="attendance-btn absent" id="absentBtn">Absent</button>
    <button class="attendance-btn leave" id="leaveBtn">Leave</button>
  </div>

  <div class="student-grid" id="studentGrid"></div>
</div>

<script>
  // 模拟后端返回数据
  const mockResponse = {
    ok: true,
    data: [
      { studentId: "S202509210001", studentName: "张三", gender: "male", leaveNote: "Sick leave" },
      { studentId: "S202509210002", studentName: "李四", gender: "female", leaveNote: "" },
      { studentId: "S202509210003", studentName: "王五", gender: "male", leaveNote: "" },
      { studentId: "S202509210004", studentName: "赵六", gender: "female", leaveNote: "Family event" },
      { studentId: "S202509210005", studentName: "钱七", gender: "male", leaveNote: "" },
      { studentId: "S202509210006", studentName: "孙八", gender: "female", leaveNote: "" }
    ]
  };

  const grid = document.getElementById("studentGrid");
  const statsBar = document.getElementById("statsBar");

  let currentMode = "present";
  const attendanceMap = new Map();

  function renderStudents() {
    grid.innerHTML = "";
    mockResponse.data.forEach(stu => {
      const card = document.createElement("div");
      card.className = "student-card";
      card.dataset.id = stu.studentId;
      card.dataset.gender = stu.gender;

      const defaultState = stu.leaveNote ? "leave" : "present";
      attendanceMap.set(stu.studentId, defaultState);
      card.classList.add(defaultState);

      const bar = document.createElement("div");
      bar.className = "status-bar";
      card.appendChild(bar);

      const nameDiv = document.createElement("div");
      nameDiv.className = "student-name";
      nameDiv.textContent = stu.studentName + " ";

      const genderIcon = document.createElement("img");
      genderIcon.src = stu.gender === "male" ? "icons/male.svg" : "icons/female.svg";
      genderIcon.alt = stu.gender;
      genderIcon.style.width = "18px";
      genderIcon.style.height = "18px";
      nameDiv.appendChild(genderIcon);
      card.appendChild(nameDiv);

      const noteDiv = document.createElement("div");
      noteDiv.className = "student-note";
      if (stu.leaveNote) noteDiv.textContent = "📝 " + stu.leaveNote;
      card.appendChild(noteDiv);

      card.addEventListener("click", () => onStudentClick(card, stu.studentId, noteDiv));
      grid.appendChild(card);
    });
    updateStats();
  }

  function onStudentClick(card, id, noteDiv) {
    attendanceMap.set(id, currentMode);
    card.classList.remove("present", "absent", "leave");
    card.classList.add(currentMode);

    if (currentMode === "leave") {
      let note = noteDiv.textContent.replace("📝 ", "") || "";
      note = prompt("Enter leave note:", note) || note;
      noteDiv.textContent = note ? "📝 " + note : "";
    } else {
      noteDiv.textContent = "";
    }
    updateStats();
  }

  function updateStats() {
    const total = attendanceMap.size;
    let p = 0, a = 0, l = 0;
    attendanceMap.forEach(v => {
      if (v === "present") p++;
      if (v === "absent") a++;
      if (v === "leave") l++;
    });
    statsBar.textContent = `Total: ${total} | 🟢 P: ${p} | 🔴 A: ${a} | 🟡 L: ${l}`;
  }

  document.getElementById("presentBtn").addEventListener("click", () => setMode("present"));
  document.getElementById("absentBtn").addEventListener("click", () => setMode("absent"));
  document.getElementById("leaveBtn").addEventListener("click", () => setMode("leave"));

  function setMode(mode) {
    currentMode = mode;
    document.querySelectorAll(".attendance-btn").forEach(btn => btn.classList.remove("active"));
    document.querySelector(`.attendance-btn.${mode}`).classList.add("active");
  }

  renderStudents();
</script>
</body>
</html>
